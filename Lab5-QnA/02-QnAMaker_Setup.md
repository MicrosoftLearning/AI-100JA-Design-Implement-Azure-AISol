# ラボ 5: カスタマイズされた QnA Maker ボットの作成

## 紹介

このラボでは、事前にトレーニングされたナレッジ ベースに接続するボットを作成するための QnA Maker について調査します。  QnAMaker を使用すると、ドキュメントをアップロードしたり、Web ページをポイントしたり、よくある質問などの一般的な使用のために単純なボットをフィードできるナレッジ ベースを事前に入力したりできます。

## ラボ 5.1: QnA Maker のセットアップ

各リソースの場所は、ラボで使用しているリージョンを選択します

1. [Azure portal](https://portal.azure.com) で、ラボ リソース グループに切り替えます。

1. 「**+ 追加**」を選択します

3. 「**QnA Maker**」と入力し、「**QnA Maker**」を選択します

4. 「**作成**」を選択します

5. 名前を入力します

6. リソース価格設定層の **Standard S0** 層を選択します。  1 MB を超えるファイルを後でアップロードするため、無料利用枠は使用していません。

1. Azure Searchの場所を選択します

8. Azure Searchの価格レベルについては、 **Free F** 層を選択します

9. アプリ名を入力します (一意の名前を指定してください)

1. Webサイトの場所を選択します

1. App Insightを有効にし、場所を選択します

10. 「**確認および作成**」を選択し、作成します。  これにより、リソース グループに次のリソースが作成されます。

- App Service プラン
- アプリ サービス
- Application Insights
- 検索サービス
- タイプ QnAMaker の Cognitive Service インスタンス

## ラボ 5.2: KnowledgeBase を作成する

1. [QnA Maker サイト](https://qnamaker.ai)を開く

1. 右上の「**Sign in**」をクリックします。QnA Maker リソースを作成した Azure 資格情報を使用してログインします

1. 上部のナビゲーション領域で、「**Create a knowledge base**」をクリックします。

1. リソースを既に作成しているため、**Step 1** をスキップします。

1. Step 2で、QnA Maker リソースに関連付けられている Azure AD とサブスクリプションを選択してから、新しく作成された QnA Maker リソースを選択します。

1. Language は English を選択します

1. 名前に「**Microsoft FAQs**」と入力します

1. ファイルについては、「**Add file**」をクリックして、**code / surface-pro-4-user-guide-EN.pdf** ファイルを参照します。

1. さらに「**Add file**」をクリックして、**code/Manage Azure Blob Storage.docx** ファイルを参照します。

    > **注**: サポートされているファイルの種類とデータソースの詳細については、[こちらをご覧ください。](https://docs.microsoft.com/ja-jp/azure/cognitive-services/qnamaker/concepts/data-sources-supported)

1. **Chit-chat** には、**Witty** を選択します。

1. 「**Create your KB**」 (KB を作成する) をクリックします。

    > **注:** これには数分かかる場合があります。

## ラボ 5.3: ナレッジ ベースを公開してテストする

1. ナレッジ ベースの QnA ペアを確認します。フィードした2つのドキュメントに基づいて、200 以上の異なるペアが表示されます。

1. トップメニューで、「**PUBLISH**」を選択します。  

1. Publishページで、「**Publish**」を選択します。  サービスが公開されたら、Successページの「**Create Bot**」ボタンをクリックします

1. ラボ リソース グループに関連付けられたアカウントとしてログインします。

1. ボット サービスの作成ページで、命名エラーを修正し、「**作成**」をクリックします。

    > **注**: Azure の最近の変更では、一部のリソース名からダッシュ（ "-"）を削除する必要があります。

1. ボット リソースが作成されたら、新しい **Web アプリ ボット**に移動し、「**Webチャットでテストする**」をクリックします

1. Surface Pro 4 または Azure Blog Storage の管理に関連する質問をボットに問い合わせてください。

    - How do I add memory?
    - How long does it take to charge the battery?
    - How do I hard reset?
    - What is a blob?

1. 次のような不明な点に関して質問をしてください。

    - How do I bowl a strike?

## ラボ 5.4: ボット ソース コードをダウンロードする

1. **ボットの管理**の下で、[**ビルド**] タブを選択

1. 「**ボット ソース コードをダウンロードする**」をクリックし、プロンプトが表示されたら「**はい**」をクリックします。  

1. Azure はソースコードをビルドします。完了したら、「**ボットソースコードのダウンロード**」をクリックし、プロンプトが表示されたら「**はい**」を選択します。

1. zip ファイルをローカル コンピュータに展開します

1. Visual Studio 2019 で .sln ソリューション ファイルを開きます

1. **Startup.cs** ファイルを開くと、特別なものは何も追加されていないことが分かります。

1. **Bots/{BotName}.cs** ファイルを開き、このファイルに対して生成されたコードを確認します。

1. **BotService.cs** ファイルを開き、このファイルに対して生成されたコードを確認します。

    >注意: 生成されたコードを確認するための前の手順は、このラボのオーサリング中にダウンロードされたソリューションに対して正しいものです。  ソリューション ファイルは、フレームワークと SDK の更新に基づいて時々変更される可能性があるため、ソリューション ファイルは異なる場合があります。  ここで重要なのは、ツールから自動的に生成されるコードを確認することです。

## さらに進む

QnAMaker コードを画像ボットに統合するには

## リソース

- [QnA Maker サービスとは](https://docs.microsoft.com/ja-jp/azure/cognitive-services/qnamaker/overview/overview)

## 次のステップ

- [ラボ 06-01: LUIS を実装する](../Lab6-Implement_LUIS/01-Introduction.md)
